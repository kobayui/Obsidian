[[ä¸è¿ç½‘æ— æ³•æ‰“å¼€htmlæ–‡ä»¶é—®é¢˜]]

D:\å·¥ä½œ\vs_wpf\2025\Monitor_Avalonia\CausalVisualizer_WebView2_demo\python_backend

testd3.py

~~~
import pandas as pd

from lingam import DirectLiNGAM

import json

  
  

def run_lingam_and_generate_dynamic_html(csv_path):

  

Â  Â  df = pd.read_csv(csv_path)

  

Â  Â  # --- è¿è¡Œ LiNGAM ---

Â  Â  model = DirectLiNGAM()

Â  Â  model.fit(df.values)

Â  Â  adj = model.adjacency_matrix_

Â  Â  cols = df.columns.tolist()

  

Â  Â  # --- æ”¶é›†è¾¹å¹¶è®¡ç®—å¼ºåº¦ ---

Â  Â  edges = []

Â  Â  for i in range(len(cols)):

Â  Â  Â  Â  for j in range(len(cols)):

Â  Â  Â  Â  Â  Â  w = float(adj[i][j])

Â  Â  Â  Â  Â  Â  if abs(w) > 0.01:

Â  Â  Â  Â  Â  Â  Â  Â  edges.append({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "source": cols[i],

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "target": cols[j],

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "weight": w,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "strength": abs(w)

Â  Â  Â  Â  Â  Â  Â  Â  })

  

Â  Â  # --- ğŸ”¥ æŒ‰å› æœå¼ºåº¦ä»å¤§åˆ°å°æ’åº ---

Â  Â  edges = sorted(edges, key=lambda e: e["strength"], reverse=True)

  

Â  Â  # --- è¾¹å®½åº¦æ˜ å°„ ---

Â  Â  max_strength = max(e["strength"] for e in edges) if edges else 1.0

  

Â  Â  # HTML ä»£ç 

Â  Â  html = f"""

<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />

<title>Causal Animation</title>

  

<style>

body {{

Â  Â  margin: 0;

Â  Â  overflow: hidden;

}}

#graph {{

Â  Â  width: 100vw;

Â  Â  height: 100vh;

Â  Â  border: 1px solid #ddd;

}}

</style>

  

<script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

  

</head>

<body>

  

<div id="graph"></div>

  

<script>

  

// èŠ‚ç‚¹

var nodes = new vis.DataSet({json.dumps([{"id": c, "label": c} for c in cols])});

  

// ç©ºè¾¹é›†åˆï¼ˆåŠ¨ç”»ç”¨ï¼‰

var edges = new vis.DataSet([]);

  

// vis ç½‘ç»œ

var container = document.getElementById('graph');

var data = {{

Â  Â  nodes: nodes,

Â  Â  edges: edges

}};

var options = {{

Â  Â  physics: {{

Â  Â  Â  Â  enabled: true,

Â  Â  Â  Â  stabilization: false

Â  Â  }},

Â  Â  edges: {{

Â  Â  Â  Â  arrows: {{ to: true }},

Â  Â  Â  Â  smooth: false

Â  Â  }},

Â  Â  nodes: {{

Â  Â  Â  Â  shape: 'dot',

Â  Â  Â  Â  size: 18

Â  Â  }}

}};

var network = new vis.Network(container, data, options);

  

// åŠ¨æ€ç»˜åˆ¶çš„è¾¹ï¼ˆæŒ‰å¼ºåº¦æ’åºåï¼‰

var causalEdges = {json.dumps(edges, ensure_ascii=False)};

  

// æœ€å¤§å¼ºåº¦ï¼ˆç”¨äºæ˜ å°„çº¿å®½ï¼‰

var maxStrength = {max_strength};

  

// åŠ¨ç”»æ’­æ”¾

let index = 0;

function addEdgeAnimated() {{

Â  Â  if (index >= causalEdges.length) return;

  

Â  Â  let e = causalEdges[index];

  

Â  Â  let width = 1 + (e.strength / maxStrength) * 8; Â  // è¶Šå¼º width è¶Šå¤§ï¼ˆèŒƒå›´çº¦ 1~9ï¼‰

  

Â  Â  edges.add({{

Â  Â  Â  Â  id: index,

Â  Â  Â  Â  from: e.source,

Â  Â  Â  Â  to: e.target,

Â  Â  Â  Â  width: width,

Â  Â  Â  Â  label: e.weight.toFixed(2)

Â  Â  }});

  

Â  Â  index++;

  

Â  Â  setTimeout(addEdgeAnimated, 700); Â // ç»˜åˆ¶é—´éš”

}}

  

// å¯åŠ¨åŠ¨ç”»

addEdgeAnimated();

  

</script>

</body>

</html>

"""

  

Â  Â  # å†™å…¥ HTML æ–‡ä»¶

Â  Â  output_file = "data251127.html"

Â  Â  with open(output_file, "w", encoding="utf-8") as f:

Â  Â  Â  Â  f.write(html)

  

Â  Â  print(f"åŠ¨æ€å› æœé“¾åŠ¨ç”»å·²ç”Ÿæˆï¼š{output_file}")

Â  Â  print("åŒå‡»æ‰“å¼€å³å¯çœ‹åˆ°å¸¦ç²—ç»†æƒå€¼çš„åŠ¨ç”»æ•ˆæœï¼ˆæ— éœ€æœåŠ¡å™¨ï¼‰")

  
  

# -------------------------

# ä¸»å…¥å£

# -------------------------

if __name__ == "__main__":

Â  Â  run_lingam_and_generate_dynamic_html("data.csv")
~~~

ç›´æ¥ç”Ÿæˆhtmlæ–‡ä»¶ï¼Œæ‰“å¼€å³å¯